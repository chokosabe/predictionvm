"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.encodeBatchMessage = exports.decodeBatchMessage = void 0;
const Marshaler_1 = require("./Marshaler");
function decodeBatchMessage(messages) {
    const messageCount = (0, Marshaler_1.decodeNumber)("uint32", messages.subarray(0, 4));
    let result = [];
    let offset = 4;
    for (let i = 0; i < messageCount; i++) {
        const messageLength = (0, Marshaler_1.decodeNumber)("uint32", messages.subarray(offset, offset + 4));
        result.push(messages.subarray(offset + 4, offset + 4 + messageLength));
        offset += 4 + messageLength;
    }
    if (offset !== messages.length) {
        throw new Error("Invalid batch message");
    }
    return result;
}
exports.decodeBatchMessage = decodeBatchMessage;
function encodeBatchMessage(messages) {
    const messageCountBytes = (0, Marshaler_1.encodeNumber)("uint32", messages.length);
    let result = new Uint8Array([...messageCountBytes]);
    for (const message of messages) {
        const lenBytes = (0, Marshaler_1.encodeNumber)("uint32", message.length);
        result = new Uint8Array([...result, ...lenBytes, ...message]);
    }
    return result;
}
exports.encodeBatchMessage = encodeBatchMessage;
